{% extends "layout/staff_layout.html" %}
{% load static %}
{% load humanize %}
{% load crispy_forms_tags widget_tweaks %}

{% block section_header %}
<section class="section-header">
  <h1>Graphical Analysis</h1>
</section>
{% endblock section_header %}
{% block content %}
<div class="card">
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h5 class="mb-3 ">Analysis for the current period ({{current_period}})</h5> 
                <hr class="hr font-weight-bolder">   
                <canvas id="awardChart" width="50" height="50" class="canvas"></canvas> 
            </div>
            <div class="col-md-6">
                <h5 class="mb-3 ">Amount allocations per level ({{current_period}})</h5> 
                <hr class="hr font-weight-bolder">   
                <canvas id="allocationChart" width="50" height="50" class="canvas"></canvas> 
            </div>            
        </div>
        <div class="row mt-3">
            <div class="col-md-12">
                <h5 class="mb-3 ">Budget Trends</h5> 
                <hr class="hr font-weight-bolder">   
                <canvas id="budgetChart" width="50" height="50" class="canvas"></canvas> 
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block customjs %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js" integrity="sha512-TW5s0IT/IppJtu76UbysrBH9Hy/5X41OTAbQuffZFU6lQ1rdcLHzpU5BzVvr/YFykoiMYZVWlr/PX1mDcfM9Qg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    $(document).ready(function (){
        $('#analytics-link').addClass('active');

        var awardChart = document.getElementById('awardChart').getContext('2d');
        var myChart = new Chart(awardChart, {
            type: 'doughnut',
            data: {
                labels: ['Sucessful', 'Unsuccessful'], //loop through queryset, 
                datasets: [{
                    label: '# of applicants',
                    data: [{{current_period.successful_applicants_count}}, {{current_period.unsuccessful_applicants_count}}],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 99, 132, 0.2)',                       
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        var allocationChart = document.getElementById('allocationChart').getContext('2d');
        var myChart = new Chart(allocationChart, {
            type: 'line',
            data: {
                labels: [{% for data in levels %}'{{data.name}}',{% endfor %}], //loop through queryset, 
                datasets: [{
                    label: 'Amount Allocated',
                    data: [{% for data in levels %}{{data.amount_allocated}},{% endfor %}],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(255, 206, 150, 0.8)',
                        'rgba(75, 192, 192, 0.9)',
                        'rgba(153, 102, 255, 0.7)',
                        'rgba(120, 118, 102, 0.7)',                       
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(120, 118, 102, 0.7)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        var budgetChart = document.getElementById('budgetChart').getContext('2d');
        var myChart = new Chart(budgetChart, {
            type: 'bar',
            data: {
                labels: [{% for data in queryset %}'{{data.year}}',{% endfor %}], //loop through queryset, 
                datasets: [{
                    label: 'Budget',
                    data: [{% for data in queryset %}{{data.budget}},{% endfor %}],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(255, 206, 150, 0.8)',
                        'rgba(75, 192, 192, 0.9)',
                        'rgba(153, 102, 255, 0.7)',
                        'rgba(120, 118, 102, 0.7)',                       
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(120, 118, 102, 0.7)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
</script>
{% endblock customjs %}